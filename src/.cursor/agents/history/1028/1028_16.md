ì§ˆë¬¸ (ì›ë³¸):
2025-10-28

ì§ˆë¬¸: @# King - ê±´ë¬¼ì£¼ (Building Owner) 
**í•™ìŠµí•´** ë‚˜ëŠ” ë°©ê¸ˆ ë§¤ì›” ë°˜ë³µí•˜ëŠ” ì¼ì •ì„ ë“±ë¡í–ˆë‹¤. í•˜ì§€ë§Œ ìº˜ë¦°ë”ì—ëŠ” í•´ë‹¹ ë‚ ì§œë§Œ ë‚˜ì˜¤ê³  ë‹¤ìŒ ì›”ì—ëŠ” ë“±ë¡í•œ ì¼ì •ì´ ë‚˜ì˜¤ì§€ ì•ŠëŠ”ë‹¤. ì˜¤ë¥˜ë¥¼ ì°¾ê³  ìˆ˜ì •í•´ë¼.

ë‹µë³€:
ê±´ë¬¼ì£¼ë¡œì„œ ë§¤ì›” ë°˜ë³µ ì¼ì •ì´ ë‹¤ìŒ ì›”ì— ë‚˜ì˜¤ì§€ ì•ŠëŠ” ì˜¤ë¥˜ë¥¼ ë°œê²¬í•˜ê³  ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.

## ğŸ” ë¬¸ì œ ë°œê²¬

### ê·¼ë³¸ ì›ì¸
**íŒŒì¼**: `src/hooks/useEventOperations.ts`

**ë¬¸ì œ**: ë°˜ë³µ ì¼ì •ì„ ì €ì¥í•  ë•Œ `generateRecurringEvents` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ

```typescript
// âŒ ê¸°ì¡´ ì½”ë“œ (ë¬¸ì œ)
const saveEvent = async (eventData: Event | EventForm) => {
  // ... 
  response = await fetch('/api/events', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(eventData),  // ë‹¨ì¼ ì´ë²¤íŠ¸ë§Œ ì €ì¥
  });
  // ...
};
```

**ê²°ê³¼**:
- ì‚¬ìš©ìê°€ "ë§¤ì›” ë°˜ë³µ" ì„ íƒí•´ë„
- ë‹¨ì¼ ì´ë²¤íŠ¸ë§Œ DBì— ì €ì¥ë¨
- ë‹¤ìŒ ì›”ì˜ ë°˜ë³µ ì¼ì •ì´ ìƒì„±ë˜ì§€ ì•ŠìŒ âŒ

## âœ… ì ìš©í•œ ìˆ˜ì •

### ìˆ˜ì • ë‚´ìš©

**íŒŒì¼**: `src/hooks/useEventOperations.ts`

#### 1. Import ì¶”ê°€
```typescript
import { generateRecurringEvents } from '../utils/recurringEventUtils';
```

#### 2. saveEvent í•¨ìˆ˜ ìˆ˜ì •

```typescript
const saveEvent = async (eventData: Event | EventForm) => {
  try {
    let response;
    
    // Check if this is a repeating event
    // <!-- ë°˜ë³µ ì¼ì •ì¸ì§€ í™•ì¸ -->
    const isRepeatingEvent = eventData.repeat.type !== 'none' && !editing;
    
    if (editing) {
      // ìˆ˜ì • ëª¨ë“œ: ë‹¨ì¼ ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸
      response = await fetch(`/api/events/${(eventData as Event).id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(eventData),
      });
    } else if (isRepeatingEvent) {
      // â­ ìƒˆë¡œìš´ ë°˜ë³µ ì¼ì •: ëª¨ë“  ë°˜ë³µ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
      // Generate recurring events
      // <!-- ë°˜ë³µ ì¼ì • ìƒì„± -->
      const tempEvent = { ...eventData, id: 'temp' } as Event;
      const recurringEvents = generateRecurringEvents(tempEvent);
      
      // Save all recurring events at once
      // <!-- ëª¨ë“  ë°˜ë³µ ì¼ì •ì„ í•œ ë²ˆì— ì €ì¥ -->
      response = await fetch('/api/events-list', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ events: recurringEvents }),
      });
    } else {
      // ì¼ë°˜ ì¼ì •: ë‹¨ì¼ ì´ë²¤íŠ¸ ì €ì¥
      response = await fetch('/api/events', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(eventData),
      });
    }

    if (!response.ok) {
      throw new Error('Failed to save event');
    }

    await fetchEvents();
    onSave?.();
    enqueueSnackbar(editing ? 'ì¼ì •ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ì¼ì •ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', {
      variant: 'success',
    });
  } catch (error) {
    console.error('Error saving event:', error);
    enqueueSnackbar('ì¼ì • ì €ì¥ ì‹¤íŒ¨', { variant: 'error' });
  }
};
```

## ğŸ¯ ìˆ˜ì • ë¡œì§ íë¦„

### Before (ìˆ˜ì • ì „)
```
1. ì‚¬ìš©ìê°€ "ë§¤ì›” ë°˜ë³µ" ì²´í¬í•˜ê³  ì¼ì • ì €ì¥
2. eventData ê°ì²´ ìƒì„± (repeat.type = 'monthly')
3. /api/eventsë¡œ POST â†’ ë‹¨ì¼ ì´ë²¤íŠ¸ë§Œ ì €ì¥ âŒ
4. ê²°ê³¼: ìº˜ë¦°ë”ì— ì›ë³¸ ë‚ ì§œë§Œ í‘œì‹œ
```

### After (ìˆ˜ì • í›„)
```
1. ì‚¬ìš©ìê°€ "ë§¤ì›” ë°˜ë³µ" ì²´í¬í•˜ê³  ì¼ì • ì €ì¥
2. eventData ê°ì²´ ìƒì„± (repeat.type = 'monthly')
3. isRepeatingEvent = true ê°ì§€ âœ…
4. generateRecurringEvents(eventData) í˜¸ì¶œ âœ…
   â†’ ë§¤ì›” ë°˜ë³µ ì¼ì • ë°°ì—´ ìƒì„±
   â†’ ì˜ˆ: 1ì›” 15ì¼, 2ì›” 15ì¼, 3ì›” 15ì¼, ...
5. /api/events-listë¡œ POST â†’ ëª¨ë“  ë°˜ë³µ ì¼ì • ì €ì¥ âœ…
6. ê²°ê³¼: ìº˜ë¦°ë”ì— ëª¨ë“  ì›”ì— ì¼ì • í‘œì‹œ âœ…
```

## ğŸ“Š ì²˜ë¦¬í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤

### 1. ë°˜ë³µ ì—†ëŠ” ì¼ë°˜ ì¼ì •
```typescript
eventData.repeat.type = 'none'
â†’ isRepeatingEvent = false
â†’ /api/eventsë¡œ ë‹¨ì¼ ì´ë²¤íŠ¸ ì €ì¥
```

### 2. ë§¤ì¼ ë°˜ë³µ
```typescript
eventData.repeat.type = 'daily'
eventData.repeat.interval = 1
eventData.repeat.endDate = '2025-02-15'
â†’ isRepeatingEvent = true
â†’ generateRecurringEvents() í˜¸ì¶œ
â†’ 1/1, 1/2, 1/3, ..., 2/15 ìƒì„±
â†’ /api/events-listë¡œ ëª¨ë‘ ì €ì¥
```

### 3. ë§¤ì£¼ ë°˜ë³µ
```typescript
eventData.repeat.type = 'weekly'
eventData.repeat.interval = 1
eventData.repeat.endDate = '2025-01-29'
â†’ isRepeatingEvent = true
â†’ generateRecurringEvents() í˜¸ì¶œ
â†’ 1/1, 1/8, 1/15, 1/22, 1/29 ìƒì„±
â†’ /api/events-listë¡œ ëª¨ë‘ ì €ì¥
```

### 4. ë§¤ì›” ë°˜ë³µ â­
```typescript
eventData.repeat.type = 'monthly'
eventData.repeat.interval = 1
eventData.repeat.endDate = '2025-05-15'
â†’ isRepeatingEvent = true
â†’ generateRecurringEvents() í˜¸ì¶œ
â†’ 1/15, 2/15, 3/15, 4/15, 5/15 ìƒì„±
â†’ /api/events-listë¡œ ëª¨ë‘ ì €ì¥ âœ…
```

### 5. ë§¤ë…„ ë°˜ë³µ
```typescript
eventData.repeat.type = 'yearly'
eventData.repeat.interval = 1
eventData.repeat.endDate = '2029-01-15'
â†’ isRepeatingEvent = true
â†’ generateRecurringEvents() í˜¸ì¶œ
â†’ 2025/1/15, 2026/1/15, 2027/1/15, 2028/1/15, 2029/1/15 ìƒì„±
â†’ /api/events-listë¡œ ëª¨ë‘ ì €ì¥
```

### 6. ìˆ˜ì • ëª¨ë“œ
```typescript
editing = true
â†’ isRepeatingEvent = false (ìˆ˜ì •ì€ ë°˜ë³µ ìƒì„±í•˜ì§€ ì•ŠìŒ)
â†’ /api/events/:idë¡œ PUT
â†’ í•´ë‹¹ ì´ë²¤íŠ¸ë§Œ ì—…ë°ì´íŠ¸
```

## ğŸ”§ ì„œë²„ ì—”ë“œí¬ì¸íŠ¸ í™œìš©

### ê¸°ì¡´ ì—”ë“œí¬ì¸íŠ¸ í™œìš©
**íŒŒì¼**: `server.js`

#### /api/events-list (POST)
ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸ë¡œ, ì—¬ëŸ¬ ì´ë²¤íŠ¸ë¥¼ í•œ ë²ˆì— ì €ì¥ ê°€ëŠ¥
```javascript
app.post('/api/events-list', async (req, res) => {
  const events = await getEvents();
  const repeatId = randomUUID();
  const newEvents = req.body.events.map((event) => {
    const isRepeatEvent = event.repeat.type !== 'none';
    return {
      id: randomUUID(),
      ...event,
      repeat: {
        ...event.repeat,
        id: isRepeatEvent ? repeatId : undefined,
      },
    };
  });

  fs.writeFileSync(
    `${__dirname}/src/__mocks__/response/${dbName}`,
    JSON.stringify({
      events: [...events.events, ...newEvents],
    })
  );

  res.status(201).json(newEvents);
});
```

**íŠ¹ì§•**:
- ì—¬ëŸ¬ ì´ë²¤íŠ¸ë¥¼ ë°°ì—´ë¡œ ë°›ìŒ âœ…
- ê° ì´ë²¤íŠ¸ì— ê³ ìœ  ID ìƒì„± âœ…
- ë°˜ë³µ ì´ë²¤íŠ¸ì— ë™ì¼í•œ `repeat.id` ë¶€ì—¬ âœ…

## ğŸ’¡ ì¢…ë£Œì¼ ì²˜ë¦¬

### ì¢…ë£Œì¼ì´ ìˆëŠ” ê²½ìš°
```typescript
eventData.repeat.endDate = '2025-05-15'
â†’ generateRecurringEvents()ëŠ” endDateê¹Œì§€ë§Œ ìƒì„±
â†’ ê²°ê³¼: ì œí•œëœ ê°œìˆ˜ì˜ ì´ë²¤íŠ¸
```

### ì¢…ë£Œì¼ì´ ì—†ëŠ” ê²½ìš°
```typescript
eventData.repeat.endDate = undefined
â†’ generateRecurringEvents()ëŠ” maxOccurrences(ê¸°ë³¸ 365)ê¹Œì§€ ìƒì„±
â†’ ê²°ê³¼: ìµœëŒ€ 365ê°œ ì´ë²¤íŠ¸
```

**ì°¸ê³ **: í–¥í›„ ê°œì„  ì‚¬í•­ìœ¼ë¡œ ì¢…ë£Œì¼ í•„ìˆ˜í™” ë˜ëŠ” ê¸°ë³¸ ì¢…ë£Œì¼ ì„¤ì • ê³ ë ¤

## ğŸ‰ ìˆ˜ì • ê²°ê³¼

### Before (ìˆ˜ì • ì „)
```
ì‚¬ìš©ì: "ë§¤ì›” 15ì¼ íŒ€ íšŒì˜" ë°˜ë³µ ì¼ì • ë“±ë¡
ê²°ê³¼: 
- 1ì›” ìº˜ë¦°ë”: "íŒ€ íšŒì˜" í‘œì‹œ âœ…
- 2ì›” ìº˜ë¦°ë”: í‘œì‹œ ì—†ìŒ âŒ
- 3ì›” ìº˜ë¦°ë”: í‘œì‹œ ì—†ìŒ âŒ
```

### After (ìˆ˜ì • í›„)
```
ì‚¬ìš©ì: "ë§¤ì›” 15ì¼ íŒ€ íšŒì˜" ë°˜ë³µ ì¼ì • ë“±ë¡ (ì¢…ë£Œì¼: 5ì›” 15ì¼)
ê²°ê³¼: 
- 1ì›” ìº˜ë¦°ë”: "íŒ€ íšŒì˜" í‘œì‹œ âœ…
- 2ì›” ìº˜ë¦°ë”: "íŒ€ íšŒì˜" í‘œì‹œ âœ…
- 3ì›” ìº˜ë¦°ë”: "íŒ€ íšŒì˜" í‘œì‹œ âœ…
- 4ì›” ìº˜ë¦°ë”: "íŒ€ íšŒì˜" í‘œì‹œ âœ…
- 5ì›” ìº˜ë¦°ë”: "íŒ€ íšŒì˜" í‘œì‹œ âœ…
```

## ğŸ“ í•™ìŠµ ë‚´ìš©

### ë¬¸ì œ ì›ì¸ (Learning Point)

**í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ì‘ì„±í–ˆì§€ë§Œ ì‹¤ì œ UIì™€ ì—°ê²°í•˜ì§€ ì•ŠìŒ**

1. âœ… `generateRecurringEvents` í•¨ìˆ˜ êµ¬í˜„ ì™„ë£Œ
2. âœ… 16ê°œ í…ŒìŠ¤íŠ¸ ëª¨ë‘ í†µê³¼
3. âŒ í•˜ì§€ë§Œ UIì—ì„œ ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
4. âŒ ê²°ê³¼: ê¸°ëŠ¥ì€ ì¡´ì¬í•˜ì§€ë§Œ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ

### í•´ê²° ë°©ë²•

**êµ¬í˜„ â†’ í…ŒìŠ¤íŠ¸ â†’ í†µí•©**

1. ìœ í‹¸ í•¨ìˆ˜ êµ¬í˜„
2. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± ë° í†µê³¼
3. **UI/Hookê³¼ í†µí•©** â­ (ì´ ë‹¨ê³„ê°€ ëˆ„ë½ë˜ì—ˆìŒ)
4. í†µí•© í…ŒìŠ¤íŠ¸ë¡œ ì „ì²´ íë¦„ í™•ì¸

### ì•ìœ¼ë¡œ ì£¼ì˜í•  ì 

- [ ] í•¨ìˆ˜ êµ¬í˜„ ì‹œ ì‹¤ì œ ì‚¬ìš©ì²˜ í™•ì¸
- [ ] í…ŒìŠ¤íŠ¸ í†µê³¼ â‰  ê¸°ëŠ¥ ì™„ì„±
- [ ] UIì™€ì˜ í†µí•©ê¹Œì§€ ì™„ë£Œí•´ì•¼ ì§„ì§œ ì™„ì„±
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ë¡œ ì „ì²´ íë¦„ ê²€ì¦

## âœ… ìµœì¢… í™•ì¸ ì‚¬í•­

```
âœ“ generateRecurringEvents í•¨ìˆ˜ êµ¬í˜„ ì™„ë£Œ
âœ“ 16ê°œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ëª¨ë‘ í†µê³¼
âœ“ useEventOperationsì— ë°˜ë³µ ì¼ì • ì €ì¥ ë¡œì§ ì¶”ê°€ âœ…
âœ“ /api/events-list ì—”ë“œí¬ì¸íŠ¸ í™œìš©
âœ“ ì¼ë°˜ ì¼ì • / ë°˜ë³µ ì¼ì • / ìˆ˜ì • ëª¨ë“œ ë¶„ê¸° ì²˜ë¦¬
âœ“ Lint ì˜¤ë¥˜ ì—†ìŒ
```

ì´ì œ ë§¤ì›” ë°˜ë³µ ì¼ì •ì„ ë“±ë¡í•˜ë©´ ë‹¤ìŒ ì›”ì—ë„ ìº˜ë¦°ë”ì— ì •ìƒì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤! ğŸŠ

