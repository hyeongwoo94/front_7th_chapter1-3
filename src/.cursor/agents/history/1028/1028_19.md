ì§ˆë¬¸ (ì›ë³¸):
2025-10-28

ì§ˆë¬¸: **í•™ìŠµí•´**
@# King - ê±´ë¬¼ì£¼ (Building Owner) 
í˜„ì¬ 31ì¼ë§¤ì›” ë“±ë¡ì„ ë§Œë“¤ì–´ì„œ ë“±ë¡ì„ í–ˆë‹¤. ê·¼ë° ì´ê²ƒì„ ìˆ˜ì •í•´ì„œ ë§¤ì›”ì„ ë§¤ì£¼ë¡œ ë³€ê²½í•˜ë ¤ê³  í–ˆëŠ”ë° ì €ì¥ ì‹¤íŒ¨ê°€ ë‚˜ì˜¨ë‹¤. ì´ê²ƒì´ ê°€ëŠ¥í•˜ê²Œ í•´ì¤˜.

ë‹µë³€:
ê±´ë¬¼ì£¼ë¡œì„œ ë°˜ë³µ ì¼ì • ìˆ˜ì • ì‹œ ë°œìƒí•˜ëŠ” ì €ì¥ ì‹¤íŒ¨ ë¬¸ì œë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤.

## ğŸ” ë¬¸ì œ ë¶„ì„

### ë°œìƒí•œ ë¬¸ì œ
ì‚¬ìš©ìê°€ 31ì¼ ë§¤ì›” ë°˜ë³µ ì¼ì •ì„ ë“±ë¡í•œ í›„, ì´ë¥¼ ìˆ˜ì •í•´ì„œ "ë§¤ì›” â†’ ë§¤ì£¼"ë¡œ ë³€ê²½í•˜ë ¤ê³  í•˜ë©´ **ì €ì¥ ì‹¤íŒ¨** ë°œìƒ

### ê·¼ë³¸ ì›ì¸

**í˜„ì¬ ì•„í‚¤í…ì²˜**:
```
1. DB ì €ì¥: 1ê°œ ì›ë³¸ ì´ë²¤íŠ¸
   {"id": "original-123", "date": "2025-01-31", "repeat": {"type": "monthly"}}

2. í™”ë©´ í‘œì‹œ: í¼ì³ì§„ ì´ë²¤íŠ¸ë“¤
   [
     {"id": "temp-1", "date": "2025-01-31", ...},
     {"id": "temp-2", "date": "2025-03-31", ...},
     {"id": "temp-3", "date": "2025-05-31", ...}
   ]

3. ìˆ˜ì • ì‹œë„:
   ì‚¬ìš©ìê°€ 3ì›” 31ì¼ ì´ë²¤íŠ¸ë¥¼ í´ë¦­ â†’ ìˆ˜ì • ëª¨ë‹¬ ì—´ë¦¼
   â†’ "ë§¤ì›” â†’ ë§¤ì£¼" ë³€ê²½ í›„ ì €ì¥
   â†’ PUT /api/events/temp-2 í˜¸ì¶œ âŒ
   â†’ ì„œë²„ì— "temp-2" IDê°€ ì—†ìŒ â†’ 404 ì˜¤ë¥˜
```

**ë¬¸ì œì **:
1. **í¼ì³ì§„ ì´ë²¤íŠ¸ì˜ ì„ì‹œ ID ì‚¬ìš©**: `temp-1`, `temp-2` ë“±ì€ í´ë¼ì´ì–¸íŠ¸ì—ì„œë§Œ ìƒì„±ëœ ID
2. **ì›ë³¸ ì´ë²¤íŠ¸ ID ë¶„ì‹¤**: ìˆ˜ì • ì‹œ ì›ë³¸ ì´ë²¤íŠ¸ ID(`original-123`)ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
3. **ë‚ ì§œ ë¶ˆì¼ì¹˜**: 3ì›” 31ì¼ ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì •í•˜ë©´ `date: "2025-03-31"`ë¡œ ì €ì¥ ì‹œë„
   - í•˜ì§€ë§Œ ì›ë³¸ì€ `date: "2025-01-31"` (ì‹œì‘ ë‚ ì§œ)

## âœ… ì ìš©í•œ ìˆ˜ì •

### 1. RepeatInfo íƒ€ì… í™•ì¥

**íŒŒì¼**: `src/types.ts`

```typescript
export interface RepeatInfo {
  type: RepeatType;
  interval: number;
  endDate?: string;
  id?: string;
  originalEventId?: string; // â­ ì›ë³¸ ì´ë²¤íŠ¸ ID (ìˆ˜ì •/ì‚­ì œìš©)
  originalDate?: string;     // â­ ì›ë³¸ ì‹œì‘ ë‚ ì§œ (ìˆ˜ì •ìš©)
}
```

**ì¶”ê°€í•œ í•„ë“œ**:
- `originalEventId`: í¼ì³ì§„ ì´ë²¤íŠ¸ê°€ ì–´ëŠ ì›ë³¸ ì´ë²¤íŠ¸ì—ì„œ ì™”ëŠ”ì§€ ì¶”ì 
- `originalDate`: ì›ë³¸ ì´ë²¤íŠ¸ì˜ ì‹œì‘ ë‚ ì§œ (ë°˜ë³µ ì¼ì •ì˜ ê¸°ì¤€ì¼)

### 2. í¼ì³ì§„ ì´ë²¤íŠ¸ì— ë©”íƒ€ë°ì´í„° ì €ì¥

**íŒŒì¼**: `src/utils/recurringEventUtils.ts`

```typescript
export function generateRecurringEvents(event: Event, maxOccurrences = 365): Event[] {
  const originalEventId = event.id;
  // ...

  events.push({
    ...event,
    id: generateEventId(), // í‘œì‹œìš© ì„ì‹œ ID
    date: dateString,      // í¼ì³ì§„ ë‚ ì§œ (3ì›” 31ì¼, 5ì›” 31ì¼ ë“±)
    repeat: {
      ...event.repeat,
      id: repeatId,
      originalEventId: originalEventId, // â­ ì›ë³¸ ì´ë²¤íŠ¸ ID ì €ì¥
      originalDate: event.date,          // â­ ì›ë³¸ ì‹œì‘ ë‚ ì§œ ì €ì¥
    },
  });
}
```

**ì €ì¥ êµ¬ì¡°**:
```json
{
  "id": "temp-2",               // ì„ì‹œ ID (í™”ë©´ í‘œì‹œìš©)
  "date": "2025-03-31",         // í¼ì³ì§„ ë‚ ì§œ
  "repeat": {
    "type": "monthly",
    "interval": 1,
    "originalEventId": "original-123",  // â­ ì›ë³¸ ID
    "originalDate": "2025-01-31"        // â­ ì›ë³¸ ì‹œì‘ ë‚ ì§œ
  }
}
```

### 3. ìˆ˜ì • ë¡œì§ ê°œì„ 

**íŒŒì¼**: `src/hooks/useEventOperations.ts`

```typescript
const saveEvent = async (eventData: Event | EventForm) => {
  try {
    let response;

    if (editing) {
      const event = eventData as Event;
      
      // â­ ë°˜ë³µ ì¼ì •ì˜ ê²½ìš° ì›ë³¸ ì´ë²¤íŠ¸ ID ì‚¬ìš©
      const updateId = event.repeat?.originalEventId || event.id;
      
      // â­ ë°˜ë³µ ì¼ì •ì˜ ê²½ìš° ì›ë³¸ ì‹œì‘ ë‚ ì§œ ì‚¬ìš©
      const updateDate = event.repeat?.originalDate || event.date;

      // ìˆ˜ì • ë°ì´í„° ì¤€ë¹„
      const updateData = {
        ...event,
        date: updateDate, // ì›ë³¸ ì‹œì‘ ë‚ ì§œë¡œ ì €ì¥
        repeat: {
          type: event.repeat.type,
          interval: event.repeat.interval,
          endDate: event.repeat.endDate,
          // originalEventId, originalDateëŠ” ì„œë²„ë¡œ ì „ì†¡ ì•ˆ í•¨
        },
      };

      response = await fetch(`/api/events/${updateId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updateData),
      });
    } else {
      // ìƒˆ ì´ë²¤íŠ¸ ë“±ë¡
      response = await fetch('/api/events', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(eventData),
      });
    }

    // ...
  }
};
```

**ìˆ˜ì • íë¦„**:
```
1. ì‚¬ìš©ì: 3ì›” 31ì¼ ì´ë²¤íŠ¸ í´ë¦­ â†’ ìˆ˜ì • ëª¨ë‹¬ ì—´ë¦¼
   - ì´ë²¤íŠ¸ ë°ì´í„°: {id: "temp-2", date: "2025-03-31", repeat: {originalEventId: "original-123", originalDate: "2025-01-31"}}

2. ì‚¬ìš©ì: "ë§¤ì›” â†’ ë§¤ì£¼" ë³€ê²½ í›„ ì €ì¥

3. saveEvent í˜¸ì¶œ:
   - updateId = "original-123" (originalEventId ì‚¬ìš©)
   - updateDate = "2025-01-31" (originalDate ì‚¬ìš©)
   - updateData = {id: "original-123", date: "2025-01-31", repeat: {type: "weekly", ...}}

4. PUT /api/events/original-123 í˜¸ì¶œ âœ…
   - ì„œë²„: ì›ë³¸ ì´ë²¤íŠ¸ ì°¾ìŒ â†’ ìˆ˜ì • ì„±ê³µ

5. fetchEvents í˜¸ì¶œ:
   - ì›ë³¸ ì´ë²¤íŠ¸: {id: "original-123", date: "2025-01-31", repeat: {type: "weekly"}}
   - í¼ì¹˜ê¸°: ë§¤ì£¼ ìˆ˜ìš”ì¼(1/31 ì‹œì‘ ìš”ì¼) ì´ë²¤íŠ¸ë“¤ ìƒì„±
```

## ğŸ“Š ë™ì‘ ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ë§¤ì›” â†’ ë§¤ì£¼ ë³€ê²½

**ì´ˆê¸° ìƒíƒœ** (DB):
```json
{
  "id": "event-001",
  "title": "íŒ€ íšŒì˜",
  "date": "2025-01-31",
  "repeat": {"type": "monthly", "interval": 1}
}
```

**í™”ë©´ í‘œì‹œ** (í¼ì³ì§„ ì´ë²¤íŠ¸):
```
âœ… 1ì›” 31ì¼ (ê¸ˆ)
âœ… 3ì›” 31ì¼ (ì›”)
âœ… 5ì›” 31ì¼ (í† )
âœ… 7ì›” 31ì¼ (ëª©)
âœ… 8ì›” 31ì¼ (ì¼)
...
```

**ìˆ˜ì • ë™ì‘**:
```
1. ì‚¬ìš©ì: 3ì›” 31ì¼ ì´ë²¤íŠ¸ í´ë¦­
2. ìˆ˜ì • ëª¨ë‹¬: "ë§¤ì›” â†’ ë§¤ì£¼" ë³€ê²½
3. ì €ì¥ í´ë¦­
4. ë‚´ë¶€ ë™ì‘:
   - updateId = "event-001" (ì›ë³¸ ID)
   - updateDate = "2025-01-31" (ì›ë³¸ ì‹œì‘ ë‚ ì§œ)
   - PUT /api/events/event-001
   - Body: {date: "2025-01-31", repeat: {type: "weekly", interval: 1}}

5. DB ì—…ë°ì´íŠ¸:
   {
     "id": "event-001",
     "date": "2025-01-31",
     "repeat": {"type": "weekly", "interval": 1}
   }

6. í™”ë©´ ê°±ì‹  (ë§¤ì£¼ ê¸ˆìš”ì¼ë¡œ í¼ì¹¨):
   âœ… 2025-01-31 (ê¸ˆ)
   âœ… 2025-02-07 (ê¸ˆ)
   âœ… 2025-02-14 (ê¸ˆ)
   âœ… 2025-02-21 (ê¸ˆ)
   ...
```

### ì˜ˆì‹œ 2: ì œëª©ë§Œ ë³€ê²½

**ì´ˆê¸° ìƒíƒœ**:
```json
{
  "id": "event-002",
  "title": "ìš´ë™",
  "date": "2025-10-01",
  "repeat": {"type": "daily", "interval": 1}
}
```

**ìˆ˜ì • ë™ì‘**:
```
1. ì‚¬ìš©ì: 10ì›” 5ì¼ ì´ë²¤íŠ¸ í´ë¦­
2. ì œëª© ë³€ê²½: "ìš´ë™" â†’ "í—¬ìŠ¤ì¥"
3. ì €ì¥ í´ë¦­
4. ë‚´ë¶€ ë™ì‘:
   - updateId = "event-002"
   - updateDate = "2025-10-01"
   - PUT /api/events/event-002
   - Body: {title: "í—¬ìŠ¤ì¥", date: "2025-10-01", repeat: {type: "daily", ...}}

5. ì „ì²´ ì‹œë¦¬ì¦ˆì˜ ì œëª©ì´ "í—¬ìŠ¤ì¥"ìœ¼ë¡œ ë³€ê²½ë¨ âœ…
```

## ğŸ¯ í•´ê²°ëœ ë¬¸ì œ

### Before (ìˆ˜ì • ì „)
```
âŒ í¼ì³ì§„ ì´ë²¤íŠ¸ ìˆ˜ì • ì‹œ ì„ì‹œ ID ì‚¬ìš©
âŒ PUT /api/events/temp-2 â†’ 404 ì˜¤ë¥˜
âŒ ë°˜ë³µ ìœ í˜• ë³€ê²½ ë¶ˆê°€ëŠ¥
âŒ ì „ì²´ ì‹œë¦¬ì¦ˆê°€ ì•„ë‹Œ ë‹¨ì¼ ì´ë²¤íŠ¸ë§Œ ìˆ˜ì •
```

### After (ìˆ˜ì • í›„)
```
âœ… ì›ë³¸ ì´ë²¤íŠ¸ ID ì‚¬ìš©
âœ… PUT /api/events/original-123 â†’ ì„±ê³µ
âœ… ë°˜ë³µ ìœ í˜• ë³€ê²½ ê°€ëŠ¥ (ë§¤ì›” â†’ ë§¤ì£¼)
âœ… ì „ì²´ ì‹œë¦¬ì¦ˆê°€ í•œ ë²ˆì— ìˆ˜ì •ë¨
âœ… ì›ë³¸ ì‹œì‘ ë‚ ì§œë¡œ ì €ì¥í•˜ì—¬ ì¼ê´€ì„± ìœ ì§€
```

## ğŸ’¡ í•™ìŠµ ë‚´ìš©

### í•µì‹¬ ê°œë…: Virtual vs Persistent ID

**Virtual ID (ì„ì‹œ ID)**:
- í™”ë©´ í‘œì‹œë¥¼ ìœ„í•´ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìƒì„±
- ê° ë Œë”ë§ë§ˆë‹¤ ë³€ê²½ë  ìˆ˜ ìˆìŒ
- DBì— ì €ì¥ë˜ì§€ ì•ŠìŒ
- ì˜ˆ: `temp-1`, `temp-2`, `generated-uuid-...`

**Persistent ID (ì˜êµ¬ ID)**:
- DBì— ì‹¤ì œë¡œ ì €ì¥ëœ ID
- ìˆ˜ì •/ì‚­ì œ ì‹œ ì‚¬ìš©í•´ì•¼ í•¨
- ë³€ê²½ë˜ì§€ ì•ŠìŒ
- ì˜ˆ: `original-123`, `event-001`

**ì›ì¹™**:
- **í‘œì‹œ**: Virtual ID ì‚¬ìš© ê°€ëŠ¥ (ê° ì´ë²¤íŠ¸ êµ¬ë¶„ìš©)
- **ìˆ˜ì •/ì‚­ì œ**: ë°˜ë“œì‹œ Persistent ID ì‚¬ìš©

### ë©”íƒ€ë°ì´í„° ì¶”ì  íŒ¨í„´

**ë¬¸ì œ**: í¼ì³ì§„ ë°ì´í„°ê°€ ì–´ë””ì„œ ì™”ëŠ”ì§€ ì¶”ì  í•„ìš”

**í•´ê²°**: ì›ë³¸ ì •ë³´ë¥¼ ë©”íƒ€ë°ì´í„°ë¡œ ì €ì¥
```typescript
{
  id: "virtual-id",        // í‘œì‹œìš©
  data: "expanded-data",   // í¼ì³ì§„ ë°ì´í„°
  metadata: {
    originalId: "...",     // ì›ë³¸ ID
    originalDate: "...",   // ì›ë³¸ ê¸°ì¤€ì¼
  }
}
```

**ì ìš©**:
- ë°˜ë³µ ì¼ì •: `originalEventId`, `originalDate`
- ê·¸ë£¹í™”ëœ ë°ì´í„°: `groupId`, `parentId`
- ê³„ì‚°ëœ ë°ì´í„°: `sourceId`, `baseValue`

### ë°ì´í„° ì¼ê´€ì„± ìœ ì§€

**ì›ì¹™**: ì›ë³¸ ë°ì´í„°ì˜ ê¸°ì¤€ì  ìœ ì§€

**ì˜ëª»ëœ ë°©ì‹**:
```typescript
// âŒ í¼ì³ì§„ ë‚ ì§œë¡œ ì €ì¥
PUT /api/events/123
Body: {date: "2025-03-31", repeat: {type: "monthly"}}
// ë¬¸ì œ: 3ì›” 31ì¼ì´ ê¸°ì¤€ì¼ì´ ë˜ì–´ë²„ë¦¼
```

**ì˜¬ë°”ë¥¸ ë°©ì‹**:
```typescript
// âœ… ì›ë³¸ ì‹œì‘ ë‚ ì§œë¡œ ì €ì¥
PUT /api/events/123
Body: {date: "2025-01-31", repeat: {type: "monthly"}}
// 1ì›” 31ì¼ì´ ê¸°ì¤€ì¼ë¡œ ìœ ì§€ë¨
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

```
âœ… ë°˜ë³µ ì¼ì • í…ŒìŠ¤íŠ¸: 16ê°œ ëª¨ë‘ í†µê³¼
âœ… Lint: ì˜¤ë¥˜ 0ê°œ
âœ… ìˆ˜ì • ê¸°ëŠ¥: ì •ìƒ ì‘ë™
   - ë§¤ì›” â†’ ë§¤ì£¼ ë³€ê²½ ê°€ëŠ¥
   - ë§¤ì£¼ â†’ ë§¤ì¼ ë³€ê²½ ê°€ëŠ¥
   - ë°˜ë³µ ìœ í˜• ììœ ë¡­ê²Œ ë³€ê²½ ê°€ëŠ¥
```

## ğŸ“ ì¶”ê°€ ê³ ë ¤ì‚¬í•­

### ë‹¨ì¼ ì´ë²¤íŠ¸ vs ì‹œë¦¬ì¦ˆ ìˆ˜ì •

**í˜„ì¬ êµ¬í˜„**: í¼ì³ì§„ ì´ë²¤íŠ¸ ì¤‘ í•˜ë‚˜ë¥¼ ìˆ˜ì •í•˜ë©´ ì „ì²´ ì‹œë¦¬ì¦ˆ ìˆ˜ì •

**í–¥í›„ ê°œì„  ê°€ëŠ¥**:
1. "ì´ ì´ë²¤íŠ¸ë§Œ ìˆ˜ì •" vs "ì „ì²´ ì‹œë¦¬ì¦ˆ ìˆ˜ì •" ì˜µì…˜ ì œê³µ
2. íŠ¹ì • ì´ë²¤íŠ¸ë§Œ ì˜ˆì™¸ ì²˜ë¦¬ (ì˜ˆ: ì´ë²ˆ ì£¼ë§Œ ì‹œê°„ ë³€ê²½)

**í˜„ì¬ëŠ” Google Calendarì™€ ìœ ì‚¬í•˜ê²Œ ì „ì²´ ì‹œë¦¬ì¦ˆ ìˆ˜ì •ìœ¼ë¡œ ë™ì‘**

### ì‚­ì œ ë™ì‘

**í˜„ì¬**: í¼ì³ì§„ ì´ë²¤íŠ¸ ì¤‘ í•˜ë‚˜ ì‚­ì œ â†’ ì „ì²´ ì‹œë¦¬ì¦ˆ ì‚­ì œ
```typescript
const deleteId = eventToDelete?.repeat?.originalEventId || id;
```

**ì¼ê´€ì„±**: ìˆ˜ì •ê³¼ ë™ì¼í•œ íŒ¨í„´

## âœ… ìµœì¢… í™•ì¸

```
âœ… ë°˜ë³µ ì¼ì • ìˆ˜ì • ê°€ëŠ¥
âœ… ë§¤ì›” â†’ ë§¤ì£¼ ë³€ê²½ ì„±ê³µ
âœ… ì›ë³¸ ì´ë²¤íŠ¸ IDë¡œ ì €ì¥
âœ… ì›ë³¸ ì‹œì‘ ë‚ ì§œ ìœ ì§€
âœ… ì „ì²´ ì‹œë¦¬ì¦ˆ ì¼ê´„ ìˆ˜ì •
âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼
```

ì´ì œ ì‚¬ìš©ìë‹˜ê»˜ì„œ 31ì¼ ë§¤ì›” ë°˜ë³µ ì¼ì •ì„ ë“±ë¡í•˜ê³ , ë‚˜ì¤‘ì— "ë§¤ì›” â†’ ë§¤ì£¼"ë¡œ ë³€ê²½í•´ë„ ì •ìƒì ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤! ğŸ‰

