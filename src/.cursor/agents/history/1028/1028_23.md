ì§ˆë¬¸ (ì›ë³¸):
2025-10-28

ì§ˆë¬¸: @# King - ê±´ë¬¼ì£¼ (Building Owner) 
**í•™ìŠµí•´**
history ì•ˆì— ìˆëŠ” 1028_15ë¶€í„° 1028_22ê¹Œì§€ í™•ì¸í•œ ë‹¤ìŒ ì¤‘ìš”í•œ ì˜¤ë¥˜ ìˆ˜ì •ì‚¬í•­ì„ agents/doc/checklist.mdì•ˆì— ë¦¬íŒ©í† ë§í•´ì„œ ì¶”ê°€í•´ë¼. ë‹¤ìŒì— ê°™ì€ ì˜¤ë¥˜ê°€ ë‚˜ì˜¤ì§€ ì•Šë„ë¡ ì‘ì„±í•´ë¼.

ë‹µë³€:
ê±´ë¬¼ì£¼ë¡œì„œ 1028_15ë¶€í„° 1028_22ê¹Œì§€ì˜ history íŒŒì¼ì„ ë¶„ì„í•˜ì—¬ ì¤‘ìš”í•œ ì˜¤ë¥˜ íŒ¨í„´ë“¤ì„ `checklist.md`ì— ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

## ğŸ“Š ë¶„ì„í•œ History íŒŒì¼ (1028_15 ~ 1028_22)

### 1028_15: ë°˜ë³µ ì¼ì • í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±
**ë‚´ìš©**: TDD ë°©ì‹ìœ¼ë¡œ `generateRecurringEvents` í•¨ìˆ˜ êµ¬í˜„
- âœ… 16ê°œ í…ŒìŠ¤íŠ¸ ì‘ì„± ë° í†µê³¼
- âœ… ë§¤ì¼/ë§¤ì£¼/ë§¤ì›”/ë§¤ë…„ ë°˜ë³µ ëª¨ë“  íŒ¨í„´ ì»¤ë²„
- âœ… ì›”ë§ ë‚ ì§œ, ìœ¤ë…„ ì²˜ë¦¬ í¬í•¨

### 1028_16: êµ¬í˜„ vs í†µí•© ê²©ì°¨ (Implementation vs Integration)
**í•µì‹¬ ë¬¸ì œ**: â­ **êµ¬í˜„í•˜ê³  í…ŒìŠ¤íŠ¸í–ˆì§€ë§Œ UIì™€ ì—°ê²° ì•ˆ í•¨**
```
âœ… generateRecurringEvents í•¨ìˆ˜ êµ¬í˜„
âœ… 16ê°œ í…ŒìŠ¤íŠ¸ ëª¨ë‘ í†µê³¼
âŒ useEventOperationsì—ì„œ í˜¸ì¶œ ì•ˆ í•¨!
â†’ ì‚¬ìš©ìê°€ ë°˜ë³µ ì¼ì • ë“±ë¡í•´ë„ ë‹¨ì¼ ì´ë²¤íŠ¸ë§Œ ì €ì¥ë¨
```

**êµí›ˆ**: 
> í…ŒìŠ¤íŠ¸ í†µê³¼ â‰  ê¸°ëŠ¥ ì™„ì„±  
> êµ¬í˜„ â†’ í…ŒìŠ¤íŠ¸ â†’ **í†µí•©** â†’ ì „ì²´ íë¦„ ê²€ì¦

### 1028_17: ì˜ëª»ëœ ë°˜ë³µ ìœ í˜• ì €ì¥
**ë¬¸ì œ**: UIì—ì„œ "ë§¤ì›”" ì„ íƒí–ˆì§€ë§Œ DBì— "weekly"ë¡œ ì €ì¥
**ì›ì¸**: ì„œë²„ í¬íŠ¸ ì¶©ëŒ + ìˆ˜ì • ì „ ì½”ë“œë¡œ ë“±ë¡
**í•´ê²°**: ì„œë²„ ì¬ì‹œì‘ + ì´ë²¤íŠ¸ ì¬ë“±ë¡

### 1028_18: Date ì˜¤ë²„í”Œë¡œìš° ì²˜ë¦¬ (Month-End Dates)
**í•µì‹¬ ë¬¸ì œ**: â­ **31ì¼ ë°˜ë³µì´ ì›”ë§ì´ ì—†ëŠ” ë‹¬ì— 28ì¼/30ì¼ë¡œ í‘œì‹œë¨**
```
ì‚¬ìš©ì ìš”êµ¬: 31ì¼ì—ë§Œ í‘œì‹œ, ì—†ìœ¼ë©´ ê±´ë„ˆë›°ê¸°
ê¸°ì¡´ ë™ì‘: 2ì›” 28ì¼, 4ì›” 30ì¼ë¡œ ì¡°ì • âŒ
```

**í•´ê²° ì „ëµ ë³€ê²½**:
```typescript
// Before: ì˜¤ë²„í”Œë¡œìš° í›„ ì¡°ì •
nextDate.setDate(31);
if (overflow) nextDate.setDate(0);  // ë§ˆì§€ë§‰ ë‚ ë¡œ ì¡°ì • âŒ

// After: ì˜¤ë²„í”Œë¡œìš° í—ˆìš© í›„ í•„í„°ë§
nextDate.setDate(31);  // ì˜¤ë²„í”Œë¡œìš° í—ˆìš©
const shouldAdd = nextDate.getDate() === 31;  // ì •í™•íˆ 31ì¼ë§Œ âœ…
```

**í•µì‹¬ ì›ì¹™**:
> ì‹œì‘ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ë§¤ë²ˆ ê³„ì‚°, ì´ì „ ê²°ê³¼ ê¸°ì¤€ âŒ

### 1028_19: Virtual vs Persistent ID
**í•µì‹¬ ë¬¸ì œ**: â­ **í¼ì³ì§„ ì´ë²¤íŠ¸ì˜ ì„ì‹œ IDë¡œ ìˆ˜ì • ì‹œë„**
```
DB: {id: "db-123", date: "2025-01-31", repeat: {type: "monthly"}}
í™”ë©´: [{id: "temp-1", date: "2025-01-31"}, {id: "temp-2", date: "2025-03-31"}]

ì‚¬ìš©ì: temp-2 ìˆ˜ì • â†’ PUT /api/events/temp-2 â†’ 404! âŒ
```

**í•´ê²°**: ë©”íƒ€ë°ì´í„° ì¶”ì 
```typescript
// í¼ì¹  ë•Œ ì›ë³¸ ID ì €ì¥
{
  id: "temp-2",
  repeat: {
    originalEventId: "db-123",  // â­ ì›ë³¸ ì¶”ì 
    originalDate: "2025-01-31"
  }
}

// ìˆ˜ì • ì‹œ ì›ë³¸ ID ì‚¬ìš©
const updateId = event.repeat?.originalEventId || event.id;
PUT /api/events/db-123  // âœ… ì„±ê³µ!
```

### 1028_20: Server ID Protection
**í•µì‹¬ ë¬¸ì œ**: â­ **Virtual IDê°€ ì„œë²„ë¡œ ì „ì†¡ë˜ì–´ ì›ë³¸ ID ë®ì–´ì”Œì›€**
```
PUT /api/events/db-123
Body: {id: "virtual-temp-456", ...}

ì„œë²„: {...old, ...body}
â†’ {id: "virtual-temp-456", ...}  // ì›ë³¸ ID ì†ì‹¤! âŒ
```

**í•´ê²°**: ì´ì¤‘ ë°©ì–´
```typescript
// í´ë¼ì´ì–¸íŠ¸: ID ì œê±°
const {id, ...dataWithoutId} = event;
fetch('/api/events/' + persistentId, {
  body: JSON.stringify(dataWithoutId)  // ID ì—†ìŒ!
});

// ì„œë²„: ID ë¬´ì‹œ
const {id: _bodyId, ...body} = req.body;
data[i] = {...old, ...body, id: req.params.id};  // URL ID ì‚¬ìš©!
```

### 1028_21: Nested Object Spread
**í•µì‹¬ ë¬¸ì œ**: â­ **repeat ê°ì²´ë§Œ ì œê±°í•´ì•¼ í•˜ëŠ”ë° idë§Œ ì œê±°**
```typescript
// âŒ ë¬¸ì œ
const {id, ...eventWithoutId} = event;  // repeat í¬í•¨!

const updateData = {
  ...eventWithoutId,  // repeat: {originalEventId, ...} í¬í•¨
  repeat: {           // override ì‹œë„
    type: newType,
    interval: newInterval
  }
};

// Object spread ìˆœì„œ ë¬¸ì œë¡œ ë©”íƒ€ë°ì´í„° ë‚¨ì„ ìˆ˜ ìˆìŒ
```

**í•´ê²°**: ëª…ì‹œì  ì œê±°
```typescript
// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
const {id, repeat, ...cleanData} = event;  // idì™€ repeat ëª¨ë‘ ì œê±°!

const updateData = {
  ...cleanData,       // repeat ì—†ìŒ!
  repeat: {           // ì™„ì „íˆ ìƒˆë¡œìš´ ê°ì²´
    type: newType,
    interval: newInterval
  }
};
```

### 1028_22: UI Layer Metadata Preservation
**í•µì‹¬ ë¬¸ì œ**: â­ **App.tsxì—ì„œ eventData ìƒì„± ì‹œ ë©”íƒ€ë°ì´í„° ì†ì‹¤**
```typescript
// âŒ ë¬¸ì œ: í¼ ë°ì´í„°ë¡œ ì™„ì „íˆ ìƒˆ ê°ì²´ ìƒì„±
const eventData = {
  id: editingEvent?.id,  // IDë§Œ ë³µì‚¬
  ...formFields,
  repeat: {              // ì™„ì „íˆ ìƒˆ ê°ì²´!
    type: formType,      // ë©”íƒ€ë°ì´í„° ì†ì‹¤!
    interval: formInterval
  }
};

// repeat.originalEventId ì—†ìŒ!
â†’ useEventOperationsì—ì„œ Virtual ID ì‚¬ìš© â†’ 404 ì˜¤ë¥˜
```

**í•´ê²°**: ì¡°ê±´ë¶€ ë³´ì¡´
```typescript
// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
const eventData = editingEvent
  ? {
      ...editingEvent,          // ì „ì²´ ë³´ì¡´!
      ...formFields,
      repeat: {
        ...editingEvent.repeat,  // ë©”íƒ€ë°ì´í„° ë³´ì¡´!
        type: formType,
        interval: formInterval
      }
    }
  : {
      // ìƒˆ ì´ë²¤íŠ¸
      ...formFields,
      repeat: {type: formType, interval: formInterval}
    };
```

**3ë‹¨ê³„ ë©”íƒ€ë°ì´í„° ì²´ì¸**:
```
1. Utils (recurringEventUtils): í¼ì¹  ë•Œ ë©”íƒ€ë°ì´í„° ì£¼ì…
2. UI (App.tsx): ìˆ˜ì • ì‹œ ë©”íƒ€ë°ì´í„° ë³´ì¡´ â­ (ì—¬ê¸°ì„œ ì‹¤ìˆ˜!)
3. Hooks (useEventOperations): ì €ì¥ ì‹œ ë©”íƒ€ë°ì´í„° í™œìš©

â†’ í•œ ë‹¨ê³„ë¼ë„ ëŠì–´ì§€ë©´ ì „ì²´ ì‹¤íŒ¨!
```

## âœ… checklist.mdì— ì¶”ê°€í•œ ì„¹ì…˜

### ì¶”ê°€í•œ 6ê°€ì§€ ì¹˜ëª…ì  ë²„ê·¸ íŒ¨í„´

**Section 5: Implementation vs Integration Gap**
<!-- êµ¬í˜„ vs í†µí•© ê²©ì°¨ -->
- í•¨ìˆ˜ êµ¬í˜„í•˜ê³  í…ŒìŠ¤íŠ¸í–ˆì§€ë§Œ UIì™€ í†µí•© ì•ˆ í•¨
- ì²´í¬ë¦¬ìŠ¤íŠ¸: êµ¬í˜„ â†’ í…ŒìŠ¤íŠ¸ â†’ **í†µí•©** â†’ ì „ì²´ ê²€ì¦

**Section 6: Date Overflow Filtering**
<!-- ë‚ ì§œ ì˜¤ë²„í”Œë¡œìš° í•„í„°ë§ -->
- JavaScript Date ìë™ ì¡°ì • ë¬¸ì œ
- í•´ê²°: ì¡°ì •ì´ ì•„ë‹Œ í•„í„°ë§
- ì›ì¹™: ì‹œì‘ì  ê¸°ì¤€ ê³„ì‚°, ì´ì „ ê²°ê³¼ ê¸°ì¤€ âŒ

**Section 7: Virtual vs Persistent ID Management**
<!-- ê°€ìƒ ID vs ì˜êµ¬ ID ê´€ë¦¬ -->
- í¼ì³ì§„ ë°ì´í„°ì˜ ì„ì‹œ ID ë¬¸ì œ
- í•´ê²°: ë©”íƒ€ë°ì´í„°ë¡œ ì›ë³¸ ì¶”ì 
- íŒ¨í„´: originalEventId, originalDate ì €ì¥

**Section 8: Nested Object Spread - Metadata Loss**
<!-- ì¤‘ì²© ê°ì²´ Spread - ë©”íƒ€ë°ì´í„° ì†ì‹¤ -->
- repeat ê°ì²´ ì¬ìƒì„± ì‹œ ë©”íƒ€ë°ì´í„° ì†ì‹¤
- í•´ê²°: idì™€ repeat ëª¨ë‘ ëª…ì‹œì  ì œê±°
- ê·œì¹™: overrideí•  ì¤‘ì²© ê°ì²´ëŠ” spreadì—ì„œ ë¨¼ì € ì œê±°

**Section 9: UI Layer Metadata Preservation**
<!-- UI ë ˆì´ì–´ ë©”íƒ€ë°ì´í„° ë³´ì¡´ -->
- í¼ ë°ì´í„°ë¡œ ìƒˆ ê°ì²´ ìƒì„± ì‹œ ë©”íƒ€ë°ì´í„° ì†ì‹¤
- í•´ê²°: editingEventë¥¼ spread í›„ í¼ìœ¼ë¡œ override
- 3ë‹¨ê³„ ì²´ì¸: Utils â†’ UI â†’ Hooks

**Section 10: Server ID Protection (Double Defense)**
<!-- ì„œë²„ ID ë³´í˜¸ (ì´ì¤‘ ë°©ì–´) -->
- Virtual IDê°€ ì„œë²„ë¡œ ì „ì†¡ë  ìœ„í—˜
- í•´ê²°: í´ë¼ì´ì–¸íŠ¸ ì œê±° + ì„œë²„ ë¬´ì‹œ
- ì´ì¤‘ ë°©ì–´ë¡œ ì•ˆì „ì„± í™•ë³´

## ğŸ“ ê° ì„¹ì…˜ì˜ êµ¬ì„±

ê° ë²„ê·¸ íŒ¨í„´ë§ˆë‹¤ ë‹¤ìŒ êµ¬ì¡°ë¡œ ì‘ì„±:

1. **Problem**: ë¬¸ì œ ì •ì˜
2. **Bad Example**: ì˜ëª»ëœ ì½”ë“œ ì˜ˆì‹œ (âŒ)
3. **Good Example**: ì˜¬ë°”ë¥¸ ì½”ë“œ ì˜ˆì‹œ (âœ…)
4. **Key Principle**: í•µì‹¬ ì›ì¹™
5. **Rule**: ë”°ë¼ì•¼ í•  ê·œì¹™

## ğŸ¯ ì—…ë°ì´íŠ¸ëœ Key Takeaways

### Coding Standards (ê¸°ì¡´ ìœ ì§€)
- LF line endings
- Import order
- File ending
- React Hooks dependencies

### Feature Implementation (ìƒˆë¡œ ì¶”ê°€)
- âœ… Implement â†’ Test â†’ **Integrate** â†’ Verify
- âœ… Date calculations: Always from start
- âœ… Expanded data: Track original with metadata
- âœ… Nested object override: Remove from spread first
- âœ… Edit mode: Spread original, then override with form
- âœ… ID protection: Remove at client, ignore at server

### Pre-Commit (ì—…ë°ì´íŠ¸)
- âœ… Run `npm run lint`
- âœ… Run `npm test -- --run` (í†µí•© ê²€ì¦ ì¶”ê°€!)
- âœ… Fix CRLF issues immediately

## ğŸ’¡ í•µì‹¬ í•™ìŠµ í¬ì¸íŠ¸

### 1. í…ŒìŠ¤íŠ¸ í†µê³¼ â‰  ê¸°ëŠ¥ ì™„ì„±
```
êµ¬í˜„ âœ… â†’ í…ŒìŠ¤íŠ¸ âœ… â†’ í†µí•© âŒ = ê¸°ëŠ¥ ì‘ë™ ì•ˆ í•¨!
```

### 2. ë©”íƒ€ë°ì´í„° ì²´ì¸ì˜ ì¤‘ìš”ì„±
```
Utils (ì£¼ì…) â†’ UI (ë³´ì¡´) â†’ Hooks (í™œìš©)
â†’ í•œ ë‹¨ê³„ë¼ë„ ëˆ„ë½ë˜ë©´ ì „ì²´ ì‹¤íŒ¨!
```

### 3. Virtual vs Persistent ID êµ¬ë¶„
```
Virtual ID: í™”ë©´ í‘œì‹œìš© (í´ë¼ì´ì–¸íŠ¸ ì „ìš©)
Persistent ID: DB ì €ì¥ìš© (ì„œë²„ ì‘ì—…ìš©)
â†’ ì ˆëŒ€ í˜¼ìš© ê¸ˆì§€!
```

### 4. Nested Object Spread ì£¼ì˜
```
ì¤‘ì²© ê°ì²´ë¥¼ overrideí•  ë•Œ:
1. ëª…ì‹œì ìœ¼ë¡œ ì œê±°
2. ì™„ì „íˆ ìƒˆë¡œìš´ ê°ì²´ ìƒì„±
3. ë©”íƒ€ë°ì´í„° ë³´ì¡´ í•„ìš” ì‹œ spread í™œìš©
```

### 5. ì´ì¤‘ ë°©ì–´ íŒ¨í„´
```
í´ë¼ì´ì–¸íŠ¸: ì‹¤ìˆ˜ ë°©ì§€ (human error)
ì„œë²„: ë³´ì•ˆ ê°•í™” (malicious/buggy clients)
â†’ ë‘˜ ë‹¤ êµ¬í˜„í•´ì•¼ ì•ˆì „!
```

## âœ… ê²€ì¦ ê²°ê³¼

```
âœ… checklist.md ì—…ë°ì´íŠ¸ ì™„ë£Œ
âœ… 6ê°€ì§€ ì¹˜ëª…ì  ë²„ê·¸ íŒ¨í„´ ì¶”ê°€
âœ… ê° íŒ¨í„´ë§ˆë‹¤ Bad/Good ì˜ˆì‹œ í¬í•¨
âœ… í•µì‹¬ ì›ì¹™ ë° ê·œì¹™ ëª…ì‹œ
âœ… Lint ì˜¤ë¥˜ 0ê°œ
âœ… ë‚´ìš© êµ¬ì¡°í™” ì™„ë£Œ
```

## ğŸ“‚ íŒŒì¼ ìœ„ì¹˜

**ì—…ë°ì´íŠ¸ëœ íŒŒì¼**: `src/.cursor/agents/doc/checklist.md`

**ìƒˆë¡œ ì¶”ê°€ëœ ì„¹ì…˜**:
- Line 234-541: "Critical Bug Patterns from Recent Fixes (2025-10-28)"
- Line 543-582: Updated "Key Takeaways"

## ğŸ‰ ê¸°ëŒ€ íš¨ê³¼

ì´ì œ ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ë¥¼ **ì‚¬ì „ì— ë°©ì§€**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. âœ… êµ¬í˜„ í›„ í†µí•© ëˆ„ë½
2. âœ… ë‚ ì§œ ì˜¤ë²„í”Œë¡œìš° ì˜ëª» ì²˜ë¦¬
3. âœ… Virtual IDì™€ Persistent ID í˜¼ìš©
4. âœ… ì¤‘ì²© ê°ì²´ ë©”íƒ€ë°ì´í„° ì†ì‹¤
5. âœ… UI ë ˆì´ì–´ì—ì„œ ë©”íƒ€ë°ì´í„° ì†ì‹¤
6. âœ… ì„œë²„ë¡œ Virtual ID ì „ì†¡

**ë‹¤ìŒ ì‘ì—… ì‹œ checklist.md ì°¸ê³ í•˜ë©´**:
- ê°™ì€ ì‹¤ìˆ˜ ë°˜ë³µ ë°©ì§€
- ì½”ë“œ ë¦¬ë·° ì‹œ ì²´í¬í¬ì¸íŠ¸
- ì‹ ê·œ ê°œë°œì ì˜¨ë³´ë”© ê°€ì´ë“œ
- TDD/êµ¬í˜„ íŒ¨í„´ ì°¸ê³  ìë£Œ

ì´ì œ 1028_15ë¶€í„° 1028_22ê¹Œì§€ì˜ ëª¨ë“  ì¤‘ìš”í•œ ì˜¤ë¥˜ íŒ¨í„´ì´ ë¬¸ì„œí™”ë˜ì–´, ê°™ì€ ì˜¤ë¥˜ê°€ ì¬ë°œí•˜ì§€ ì•Šë„ë¡ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ğŸ“š

